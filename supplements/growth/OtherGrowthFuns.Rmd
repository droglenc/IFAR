---
layout: page
title: Individual Growth
subtitle: Other Growth Functions
author: Derek H. Ogle
csl: ../american-fisheries-society.csl
bibliography: ../IFARSupplement.bib
output: 
  html_document: 
    fig_width: 5
    self_contained: no
---
```{r echo=FALSE, eval=FALSE}
##############################################################
# == BEGIN -- NOT SHOWN IN SUPPLEMENT, FOR PRINTING ONLY =====
# First line renders an appropriate HTML file for the webpage
# Second line makes the script file
# RUN BOTH MANUALLY (following using Knit HTML button)
setwd("C:/aaaWork/Web/GitHub/IFAR/supplements/growth")
source("../../rhelpers/modHTML.R"); modHTML2("OtherGrowthFuns")
if (require(FSA)) purl2("OtherGrowthFuns.Rmd",topnotes="User must set working directory appropriately.")
# == END -- NOT SHOWN IN SUPPLEMENT, FOR PRINTING ONLY =====
##############################################################
```

The von Bertalanffy Growth Function (VBGF) was introduced and methods for fitting the model were illustrated in the book.  Other growth functions exist and are illustrated in this supplement.  Methods for [fitting other parameterizations of the VBGF are here](OtherVBGFParams.html) and [alternative nonlinear model fitting algorithms are illustrated here](OtherNLAlgorithms.html).

### Required Packages for this Supplement
Functions used in this supplement require the packages shown below.

```{r echo=FALSE, results='hide', message=FALSE, warnings=FALSE}
##############################################################
# == BEGIN -- NOT SHOWN IN SUPPLEMENT, FOR PRINTING ONLY =====
# 
# Setup of knitr
source("../../rhelpers/knitr_setup.R")
# declare packages used
rqrd <- c("FSA","dplyr","nlstools","AICcmodavg","captioner","knitr")
# setup figure, table, and equation captioning
library(captioner)
figcaps <- captioner(prefix="Figure")
figcaps("RichardsStarts","Richards growth function evaluated at potential starting values superimposed on the length-at-age data for male Black Drum.")
figcaps("OtherGFCompare","Fitted models for the von Bertalanffy (black), Richards (blue), Gompertz (red), and logistic (orange) growth functions fit to the male Black Drum data.")
# == END -- NOT SHOWN IN SUPPLEMENT, FOR PRINTING ONLY =====
##############################################################
```
```{r cache=FALSE, results='hide', message=FALSE}
library(FSA)
library(dplyr)
library(nlstools)
library(AICcmodavg)
```

### Data Used in this Supplement
  
The male Black Drum ([view](https://github.com/droglenc/FSAdata/blob/master/data-raw/BlackDrum2001.csv), [download](https://raw.githubusercontent.com/droglenc/FSAdata/master/data-raw/BlackDrum2001.csv), [meta-data](http://derekogle.com/fishR/data/data-html/BlackDrum2001.html)) data used in the book will also be used here.
```{r}
bdmf <- read.csv("BlackDrum2001.csv") %>%
  select(-c(spname,day,weight)) %>%
  filterD(sex %in% c("male","female"),otoage<50)
bdm <- filterD(bdmf,sex=="male")
headtail(bdm)
```


## Fitting Other Growth Functions

Mean length-at-age has been modeled by functions other than the VBGF.  Common other functions are the exponential, logistic, and polynomial (@Ricker1975), as well as the specific functions of @Gompertz1825, @Richards1959, @Schnute1981, and @SchnuteRichards1990.  The "Schnute" model and several parameterizations of the logistic, Gompertz, and Richards models have been coded in convenience functions in `FSA`.  For example, the default parameterizations of the logistic, Gompertz, and Richards models are defined below.  Again, include `msg=TRUE` for definitions of the parameters.  Further note that the Richards model has four parameters.
```{r}
l1 <- logisticFuns()
g1 <- GompertzFuns()
r1 <- RichardsFuns()
```

Unfortunately, convenience functions for finding starting values for each of these functions do not exist.  Starting values can be obtained by iteratively superimposing a curve of the function at chosen values for the parameters onto a scatterplot of the raw data.  This is demonstrated below for the Richards function.  [Note that this may take considerable trial-and-error to find parameter values that provide a curve in the "neighborhood" of the data.  Starting values likely only need to provide a rough fit to the data.  However, I had considerable difficult finding starting values that would work with the Richards function for these data.]

```{r}
plot(tl~otoage,data=bdm,pch=19,col=rgb(0,0,0,1/4),
     xlab="Otolith Age",ylab="Total Length (mm)")
svR1 <- list(Linf=1200,k=0.1,a=1.1,b=0.4)
curve(r1(x,unlist(svR1)),from=3,to=42,add=TRUE,lwd=2)
```

`r figcaps("RichardsStarts")`

A similar process (not shown) was followed for the logistic and Gompertz models.

```{r echo=FALSE, results="hide", fig.show="hide"}
# ############################################################
# == BEGIN -- NOT SHOWN IN SUPPLEMENT, FOR SCRIPT ONLY =======
plot(tl~otoage,data=bdm,pch=19,col=rgb(0,0,0,1/4))
svG1 <- list(Linf=1250,gi=0.15,ti=2)
curve(g1(x,unlist(svG1)),from=3,to=42,add=TRUE,lwd=2)
plot(tl~otoage,data=bdm,pch=19,col=rgb(0,0,0,1/4))
svL1 <- list(Linf=1250,gninf=0.15,ti=4)
curve(l1(x,unlist(svL1)),from=3,to=42,add=TRUE,lwd=2)
# == END -- NOT SHOWN IN SUPPLEMENT, FOR SCRIPT ONLY =========
# ############################################################
```
```{r}
svG1 <- list(Linf=1250,gi=0.15,ti=2)
svL1 <- list(Linf=1250,gninf=0.15,ti=4)
```

These models can be fit and summarized as illustrated above and in the book.

```{r}
fitR1 <- nls(tl~r1(otoage,Linf,k,a,b),data=bdm,start=svR1)
bootR1 <- nlsBoot(fitR1)
cbind(Ests=coef(fitR1),confint(bootR1))
predict(bootR1,r1,t=3)
```

Information criterion can be used to identify which of these models best fits the male Black Drum data.  First, the von Bertalanffy (as fit in the book), Gompertz, and logistic functions are fit to the data.

```{r}
vbTyp <- vbFuns()
svTyp <- list(Linf=1193,K=0.13,t0=-2.0)
fitTyp <- nls(tl~vbTyp(otoage,Linf,K,t0),data=bdm,start=svTyp)
fitG1 <- nls(tl~g1(otoage,Linf,gi,ti),data=bdm,start=svG1)
fitL1 <- nls(tl~l1(otoage,Linf,gninf,ti),data=bdm,start=svL1)
```

These objects are then submitted to `AICctab` to provide a summary table.  From this, the Richards models is most supported followed by the VBGF.  The logistic and Gompertz models had little support, likely because they force an inflection point in the model which is not apparent in the data.

```{r}
aictab(list(fitTyp,fitL1,fitG1,fitR1),c("VBGF","logistic","Gompertz","Richards"))
```

A plot of the best-fit model for each growth function (`r figcaps("OtherGFCompare",display="cite")`) shows, however, that there is likely very little difference in predicted values among the four models.

```{r}
plot(tl~otoage,data=bdm,pch=19,col=rgb(0,0,0,1/4),
     xlab="Otolith Age",ylab="Total Length (mm)")
curve(vbTyp(x,coef(fitTyp)),from=3,to=42,add=TRUE,lwd=6)
curve(r1(x,coef(fitR1)),from=3,to=42,add=TRUE,lwd=4,col="blue")
curve(g1(x,coef(fitG1)),from=3,to=42,add=TRUE,lwd=2,col="red")
curve(l1(x,coef(fitL1)),from=3,to=42,add=TRUE,col="orange")
```

`r figcaps("OtherGFCompare")`

--------------------------------------------------------------

```{r echo=FALSE, results='asis'}
reproInfo(rqrdPkgs=rqrd,out="markdown",links=c(Script="OtherGrowthFuns.R",RMarkdown="OtherGrowthFuns.Rmd"))
```

--------------------------------------------------------------

## References
